= DTR -- Distributed Test Runner

Supporting DTR version: 1.x.x

This package contains DTR, a distributed test runner program for decreasing 
time of running ruby tests, only supporting Test::Unit ruby testing framework
currently.

DTR has the following features:

* Run tests in mutli processes or on distributed machines.

* Hot plug distributed agents.

* Runtime injection, all tests run in same environment.

DTR works in two parts: Runner Agent and DTR Master.

* Runner Agent is a DRb service hosting on distributed machines to run tests. For using 'fork' to create runner process, Runner Agent can't run on Windows directly.

* DTR Master is the process finding runner service to run tests and collect test results. It works by loading 'dtr/test_unit_injection.rb' with all test files.

DTR support synchronize codebase by creating a DTR::PackageTask in your rakefile. The DTR::PackageTask is a similar task with Rake::PackageTask, the following is a simple example:

  % require 'dtr/raketasks'
  % DTR::PackageTask.new do |p|
  %   p.package_files.include("**/*")
  %   p.package_files.exclude("tmp")
  %   p.package_files.exclude("log")
  % end

== Download

The latest version of DTR can be found at

* http://github.com/xli/dtr/tree/master

== Installation

=== Normal Installation

You can install DTR with the following command.

  % ruby install.rb

from its distribution directory. or create a gem and install it:

  % rake gem
  % sudo gem install pkg/dtr-version.gem

=== GEM Installation

==== Last stable version from rubyforge.org

Download and install DTR with the following.

   gem install --remote dtr

==== Last version from on github master branch

Run the following if you haven't already:

  gem sources -a http://gems.github.com

Install the gem:

  sudo gem install xli-dtr


=== Running the DTR Test Suite

If you wish to run the unit and functional tests that come with DTR:

* CD into the top project directory of dtr.
* Type the following:

   rake # You need a version of rake installed

== Simple Example

Start DTR agent with providing 2 runners as follows:

  % dtr --broadcast_ip broadcast_ip -r runner1,runner2

Type "dtr --help" for an up-to-date option summary.
Invoking <tt>dtr</tt> without any options causes dtr to show help too.

Most of time your project test suite need setup environment before run tests, you
can set setup command by option '--setup', for example:

  % dtr --broadcast_ip broadcast_ip -r runner1,runner2 --setup "rake db:test:prepare"

You also can specify DTR_AGENT_ENV_SETUP_CMD in your master process environment to let all agents setup same environment.

At last, you need to add 'dtr/test_unit_injection.rb' into test_files of your test 
task in your Rakefile, and for load it, you also need add dtr lib path:

  require 'dtr'

  DTR.broadcast_list = ['broadcast_ip']

  Rake::TestTask.new(:dtr_tests) do |t|
    t.libs << DTR.lib_path
    t.test_files = FileList['dtr/test_unit_injection.rb', 'test/*test.rb']
    t.warning = false
    t.verbose = false
  end

In the case above we changed dtr broadcast list for looking for agents.

All DTR options would be cached in the directory running the test or agent process.

== Run tests in multi-processes on one machine

For running Runner in multi-processes.
The following is the test task example in the rake file:

  require 'dtr/raketasks'

  DTR::TestTask.new :test do |t|
    t.test_files = FileList['test/*test.rb']
    t.processes = 2 #default is 2
  end

== Credits

[<b>Josh Price</b>] For fixing tests packer in release 0.0.1.

[<b>Wang Pengchao</b>] For sharing lots of ideas.

[<b>Barrow H Kwan</b>] For patch of specifying DTR server port.

[<b>Mingle team</b>(http://studios.thoughtworks.com/mingle-project-intelligence)] For making all these happen.

== License

DTR is available under an Apache License Version 2.

== Support

Feel free to submit commits or feature requests.
For other information, feel free to contact mailto:iam@li-xiao.com.

== Usage

DTR agent command is invoked from the command line using:

   % dtr [<em>options</em> ...]

=== Options are:

  -p, --port PORT                  Port number of DTR rinda server. Default is 3344.
  -r runner1_name,runner2_name     Start DTR test runner agent with unique runner names.
  -a, --broadcast_address ADDRESS  Specify broadcast address for looking up dtr rinda server, e.g. 192.168.255.255. Default is 'localhost'.
  -i, --setup COMMAND              Set command for initializing test runner test environment, e.g. 'rake db:test:prepare'. Default is do nothing. You also can specify DTR_AGENT_ENV_SETUP_CMD in your master process environment to let all agents setup same environment.
  -m, --monitor                    Monitor the status of the dtr agents.
  -d, --debug                      output debug log
  -b, --be_silent                  Only show error messages
  -v, --version                    Show version
  -h, --help                       Show this help doc

Type "dtr --help" for an up-to-date option summary.

= Other stuff

Author::  Li Xiao <iam@li-xiao.com>
Requires:: Ruby 1.8.5 or later
License::  Copyright 2007-2008 by Li Xiao.
           Released under an Apache License 2.  See the LICENSE file
           included in the distribution.

== Warranty

This software is provided "as is" and without any express or
implied warranties, including, without limitation, the implied
warranties of merchantibility and fitness for a particular
purpose.
